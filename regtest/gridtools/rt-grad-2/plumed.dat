s1x_dist: DISTANCES ATOMS=1-50 ORIGIN=1 COMPONENTS

d2: COORDINATIONNUMBER SPECIES=1-50 SWITCH={RATIONAL R_0=2.0} MORE_THAN={EXP R_0=4.0}
d2x_numer: KDE ARG=s1x_dist.x HEIGHTS=d2 GRID_BIN=4 KERNEL=gaussian-bin BANDWIDTH=1.0  
d2y_numer: KDE ARG=s1x_dist.y HEIGHTS=d2 GRID_BIN=4 KERNEL=gaussian-bin BANDWIDTH=1.0
d2z_numer: KDE ARG=s1x_dist.z HEIGHTS=d2 GRID_BIN=4 KERNEL=gaussian-bin BANDWIDTH=1.0
d2x_denom: KDE ARG=s1x_dist.x GRID_BIN=4 KERNEL=gaussian-bin BANDWIDTH=1.0
d2y_denom: KDE ARG=s1x_dist.y GRID_BIN=4 KERNEL=gaussian-bin BANDWIDTH=1.0
d2z_denom: KDE ARG=s1x_dist.z GRID_BIN=4 KERNEL=gaussian-bin BANDWIDTH=1.0

d2xn: MATHEVAL ARG=d2x_numer,d2x_denom FUNC=x/y PERIODIC=NO
d2xs: INTERPOLATE_GRID ARG=d2xn MIDPOINTS INTERPOLATION_TYPE=ceiling
d2x: CUSTOM ARG=d2xn,d2xs FUNC=(x-y)*(x-y) PERIODIC=NO
d2yn: MATHEVAL ARG=d2y_numer,d2y_denom FUNC=x/y PERIODIC=NO
d2ys: INTERPOLATE_GRID ARG=d2yn MIDPOINTS INTERPOLATION_TYPE=ceiling 
d2y: CUSTOM ARG=d2yn,d2ys FUNC=(x-y)*(x-y) PERIODIC=NO
d2zn: MATHEVAL ARG=d2z_numer,d2z_denom FUNC=x/y PERIODIC=NO
d2zs: INTERPOLATE_GRID ARG=d2zn MIDPOINTS INTERPOLATION_TYPE=ceiling
d2z: CUSTOM ARG=d2zn,d2zs FUNC=(x-y)*(x-y) PERIODIC=NO

g1x: SUM_GRID ARG=d2x PERIODIC=NO
g1y: SUM_GRID ARG=d2y PERIODIC=NO
g1z: SUM_GRID ARG=d2z PERIODIC=NO
s2: COMBINE ARG=g1x,g1y,g1z PERIODIC=NO
PRINT ARG=g1x,s2,d2.* FILE=colvar2 FMT=%8.4f
BIASVALUE ARG=g1x
